<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Cartas Individuales | Luzzzen Cards</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css">

  <!-- FAVICON -->
<link rel="icon" type="image/x-icon" href="favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">

<!-- APP / MOBILE -->
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<link rel="manifest" href="site.webmanifest">

</head>

<body>

<header>
  <a href="index.html" class="btn-volver">‚Üê Volver al inicio</a>
  <h1>Cartas individuales</h1>
  <p>Cartas de f√∫tbol disponibles</p>
</header>

<main>

<section id="productos">
  <div class="catalogo">

    <!-- CARTA 1 -->
    <div class="carta">
      <div class="imagenes-carta">
        <img src="imagenes/HazardPruebaFront.jpg" alt="Hazard frente">
        <img src="imagenes/HazardPruebaBack.jpg" alt="Hazard dorso">
      </div>
      <h4 class="titulo-carta">Hazard - Chelsea ‚Äì Panini WCCF 2016</h4>
      <p class="precio">$7.500</p>
      <button class="agregar">Agregar al pedido</button>
    </div>

    <!-- CARTA 2 -->
    <div class="carta">
      <div class="imagenes-carta">
        <img src="imagenes/HazardPruebaFront.jpg" alt="Drogba frente">
        <img src="imagenes/HazardPruebaBack.jpg" alt="Drogba dorso">
      </div>
      <h4 class="titulo-carta">Didier Drogba ‚Äì Panini Colecci√≥n 2016</h4>
      <p class="precio">$5.000</p>
      <button class="agregar">Agregar al pedido</button>
    </div>

  </div>
</section>

<section id="pedido">
  <h2>Tu pedido</h2>
  <ul id="lista-pedido"></ul>
  <p id="total">Total: $0</p>
  <button id="vaciar">Vaciar pedido</button>
  <button id="whatsapp">Enviar pedido por WhatsApp</button>
</section>

<div class="volver-footer">
  <a href="index.html" class="btn-volver">‚Üê Volver al inicio</a>
</div>

</main>

<!-- MODAL IM√ÅGENES -->
<div id="modal" class="modal">
  <button class="flecha izquierda">‚Äπ</button>
  <img id="modal-img">
  <button class="flecha derecha">‚Ä∫</button>
</div>

<!-- CARRITO FLOTANTE -->
<button id="carrito-float">
  üõí
  <span id="carrito-badge">0</span>
</button>

<!-- DRAWER -->
<div id="drawer-overlay"></div>

<aside id="drawer-carrito">
  <header class="drawer-header">
    <h3>Tu pedido</h3>
    <button id="cerrar-drawer">‚úï</button>
  </header>

  <ul id="drawer-lista"></ul>

<div class="drawer-footer">
  <p id="drawer-total">Total: $0</p>

  <button id="drawer-vaciar" class="drawer-secundario">
    Vaciar carrito
  </button>

  <button id="drawer-whatsapp">
    Enviar pedido por WhatsApp
  </button>
</div>
</aside>

<script>
/* =========================
   VARIABLES BASE
========================= */

const botonesAgregar = document.querySelectorAll(".agregar");
const listaPedido = document.getElementById("lista-pedido");
const totalTexto = document.getElementById("total");
const botonWhatsapp = document.getElementById("whatsapp");
const botonVaciar = document.getElementById("vaciar");

const carritoFloat = document.getElementById("carrito-float");
const carritoBadge = document.getElementById("carrito-badge");

let items = [];
let total = 0;

/* =========================
   LOCAL STORAGE
========================= */

function guardarCarrito() {
  localStorage.setItem("luzzzenCarrito", JSON.stringify(items));
  localStorage.setItem("luzzzenTotal", total);
}

function cargarCarrito() {
  const carritoGuardado = localStorage.getItem("luzzzenCarrito");
  const totalGuardado = localStorage.getItem("luzzzenTotal");

  if (!carritoGuardado) return;

  items = JSON.parse(carritoGuardado);
  total = parseInt(totalGuardado) || 0;

  items.forEach(item => agregarItemDOM(item.nombre, item.precio));
  actualizarTotal();
  actualizarCarritoFloat();
}

/* =========================
   CARRITO
========================= */

function agregarItemDOM(nombre, precio) {
  const li = document.createElement("li");
  li.innerHTML = `
    ${nombre} ‚Äì $${precio.toLocaleString()}
    <button class="eliminar">‚úï</button>
  `;

  li.querySelector(".eliminar").addEventListener("click", () => {
    listaPedido.removeChild(li);
    items = items.filter(i => i.nombre !== nombre);
    total -= precio;
    actualizarTotal();
    actualizarCarritoFloat();
    guardarCarrito();
  });

  listaPedido.appendChild(li);
}

botonesAgregar.forEach(boton => {
  boton.addEventListener("click", () => {
    const carta = boton.closest(".carta");
    const nombre = carta.querySelector(".titulo-carta").innerText;
    const precio = parseInt(carta.querySelector(".precio").innerText.replace(/\D/g, ""));

    if (items.some(item => item.nombre === nombre)) {
      alert("Esta carta ya est√° en tu pedido.");
      return;
    }

    items.push({ nombre, precio });
    agregarItemDOM(nombre, precio);

    total += precio;
    actualizarTotal();
    actualizarCarritoFloat();
    guardarCarrito();
  });
});

botonVaciar.addEventListener("click", () => {
  listaPedido.innerHTML = "";
  items = [];
  total = 0;
  actualizarTotal();
  actualizarCarritoFloat();
  localStorage.clear();
});

function actualizarTotal() {
  totalTexto.innerText = `Total: $${total.toLocaleString()}`;
}

/* =========================
   WHATSAPP
========================= */

botonWhatsapp.addEventListener("click", () => {
  if (items.length === 0) return alert("No agregaste ninguna carta.");

  const codigo = `LZ-${Date.now()}`;
  let mensaje = `Pedido ${codigo}%0A%0A`;

  items.forEach(i => mensaje += `‚Ä¢ ${i.nombre} - $${i.precio.toLocaleString()}%0A`);
  mensaje += `%0A Total: $${total.toLocaleString()}`;

  window.open(`https://wa.me/5491125608635?text=${mensaje}`, "_blank");
});

/* =========================
   CARRITO FLOTANTE + DRAWER
========================= */

function actualizarCarritoFloat() {
  carritoBadge.innerText = items.length;
  carritoFloat.style.display = items.length ? "flex" : "none";
}

const drawer = document.getElementById("drawer-carrito");
const drawerOverlay = document.getElementById("drawer-overlay");
const drawerLista = document.getElementById("drawer-lista");
const drawerTotal = document.getElementById("drawer-total");
const cerrarDrawerBtn = document.getElementById("cerrar-drawer");
const drawerWhatsapp = document.getElementById("drawer-whatsapp");

function abrirDrawer() {
  drawerLista.innerHTML = "";

  items.forEach(item => {
    const li = document.createElement("li");
    li.innerHTML = `
      ${item.nombre} ‚Äì $${item.precio.toLocaleString()}
      <button class="eliminar">‚úï</button>
    `;

    li.querySelector(".eliminar").addEventListener("click", () => {
      // eliminar del carrito principal
      items = items.filter(i => i.nombre !== item.nombre);
      total -= item.precio;

      // refrescar UI
      listaPedido.innerHTML = "";
      items.forEach(i => agregarItemDOM(i.nombre, i.precio));

      actualizarTotal();
      actualizarCarritoFloat();
      guardarCarrito();
      abrirDrawer(); // refresca drawer
    });

    drawerLista.appendChild(li);
  });

  drawerTotal.innerText = `Total: $${total.toLocaleString()}`;
  drawer.classList.add("abierto");
  drawerOverlay.classList.add("activo");
}

function cerrarDrawer() {
  drawer.classList.remove("abierto");
  drawerOverlay.classList.remove("activo");
}

carritoFloat.addEventListener("click", abrirDrawer);
cerrarDrawerBtn.addEventListener("click", cerrarDrawer);
drawerOverlay.addEventListener("click", cerrarDrawer);
drawerWhatsapp.addEventListener("click", () => botonWhatsapp.click());

const drawerVaciar = document.getElementById("drawer-vaciar");

drawerVaciar.addEventListener("click", () => {
  listaPedido.innerHTML = "";
  items = [];
  total = 0;

  actualizarTotal();
  actualizarCarritoFloat();
  guardarCarrito();
  cerrarDrawer();
});

/* =========================
   INIT
========================= */

actualizarCarritoFloat();
cargarCarrito();

/* =========================
   MODAL DE IM√ÅGENES (FIX DEFINITIVO)
========================= */

const modal = document.getElementById("modal");
const modalImg = document.getElementById("modal-img");
const flechaIzq = document.querySelector(".flecha.izquierda");
const flechaDer = document.querySelector(".flecha.derecha");

let imagenes = [];
let indice = 0;

// ABRIR MODAL (SIEMPRE DESDE EL FRENTE)
document.querySelectorAll(".imagenes-carta").forEach(contenedor => {
  contenedor.addEventListener("click", e => {
    e.stopPropagation();

    imagenes = [...contenedor.querySelectorAll("img")];
    indice = 0; // üëà SIEMPRE arranca en la primera imagen

    modalImg.src = imagenes[indice].src;
    modal.style.display = "flex";

    if (imagenes.length > 1) {
      flechaIzq.style.display = "block";
      flechaDer.style.display = "block";
    } else {
      flechaIzq.style.display = "none";
      flechaDer.style.display = "none";
    }
  });
});

// Flechas
flechaDer.addEventListener("click", e => {
  e.stopPropagation();
  indice = (indice + 1) % imagenes.length;
  modalImg.src = imagenes[indice].src;
});

flechaIzq.addEventListener("click", e => {
  e.stopPropagation();
  indice = (indice - 1 + imagenes.length) % imagenes.length;
  modalImg.src = imagenes[indice].src;
});

// Cerrar modal
modal.addEventListener("click", () => {
  modal.style.display = "none";
});

// Swipe mobile
let touchStartX = 0;
let touchEndX = 0;

modalImg.addEventListener("touchstart", e => {
  touchStartX = e.changedTouches[0].screenX;
});

modalImg.addEventListener("touchend", e => {
  touchEndX = e.changedTouches[0].screenX;
  const diff = touchStartX - touchEndX;

  if (diff > 50 && imagenes.length > 1) {
    indice = (indice + 1) % imagenes.length;
    modalImg.src = imagenes[indice].src;
  }

  if (diff < -50 && imagenes.length > 1) {
    indice = (indice - 1 + imagenes.length) % imagenes.length;
    modalImg.src = imagenes[indice].src;
  }
});
  
</script>

</body>
</html>
